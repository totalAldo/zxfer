# TODO – Security Review

- [ ] **Command injection while creating destination datasets** (`src/zxfer_transfer_properties.sh:386` and `src/zxfer_transfer_properties.sh:425`)
  - When the destination dataset does not yet exist, `transfer_properties()` converts the source property list (and any `-o` overrides) into `override_option_list`/`creation_option_list` by wrapping each value in single quotes and then runs `eval "$g_RZFS create … $g_actual_dest"` (lines `src/zxfer_transfer_properties.sh:405` and `src/zxfer_transfer_properties.sh:442`). Property values come directly from `zfs get` on the source, so they can contain arbitrary characters, including single quotes or shell syntax. A crafted value such as `foo'; touch /tmp/pwn #'` breaks out of the quoted segment and injects an arbitrary command that runs as soon as zxfer tries to create the destination dataset.
  - **Impact:** Any source dataset (or even a user-provided `-o property=value`) can execute arbitrary shell commands on the system receiving the replication before any ZFS operations complete.
  - **Fix:** Eliminate `eval` here. Build the `zfs create` command using proper quoting—e.g., accumulate options in an array and pass them to `"$g_RZFS" create "$@"`—or escape single quotes inside values before interpolating them. Without executing the string via `eval`, property values remain data and cannot terminate the command prematurely.

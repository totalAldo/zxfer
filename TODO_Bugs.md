# TODO – Logical Bugs

- [ ] `src/zxfer_zfs_send_receive.sh:112-125,166-182` – Progress bars (`-D`) inject a double-quoted `zxfer_progress_passthrough "..."` pipeline into the send command but the string is later wrapped in another pair of double quotes when `-O` pulls from a remote host. The nested quotes are never re-escaped, so `ssh` sees a broken command and `zxfer -O -D ...` fails before any data is sent. Re-escape the progress string (or switch to single quotes) before embedding it in the remote `ssh` wrapper.
- [ ] `src/zxfer_zfs_send_receive.sh:50-58,133-159` – `calculate_size_estimate()` always runs `zfs send -nPv <snapshot>` even when `zfs_send_receive()` is about to perform an incremental `zfs send -I <last_common> <current>`. That makes the estimated byte count report the size of a full stream instead of the incremental delta, so the progress dialog races to 100% almost immediately while ZFS is still transmitting. Pass the previous snapshot (when present) into the estimator so the progress meter reflects the actual stream that will run.
- [ ] `src/zxfer_zfs_send_receive.sh:245-275` & `src/zxfer_zfs_mode.sh:429-455` – `g_is_performed_send_destroy` is unconditionally set to `1` after building a send/receive command even when `-n/--dryrun` short-circuits `execute_command()`. As a result `-Y` loops never see the “no work performed” condition and dry-run jobs spin through the maximum eight iterations. Gate the flag on whether the send actually ran (or on non-dry-run mode) so `-Y -n` converges after the first pass.
